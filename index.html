<!DOCTYPE html>

<html>
<head>

</head>
<body>
<h3>Here are your sensors</h3>
<h2>SENSOR FOR DEVICEORIENTATION:</h2>
<div>
    <span>X-Orienation: </span>
    <span id="orientation_x">No X Orientation</span>
</div>
<div>
    <span>Y-Orienation: </span>
    <span id="orientation_y">No Y Orientation</span>
</div>
<div>
    <span>Z-Orienation: </span>
    <span id="orientation_z">No Z Orientation</span>
</div>

<h2>SENSOR FOR DEVICEMOTION:</h2>
<div>
    <span>X-Orienation: </span>
    <span id="motion_x">No X Orientation</span>
</div>
<div>
    <span>Y-Orienation: </span>
    <span id="motion_y">No Y Orientation</span>
</div>
<div>
    <span>Z-Orienation: </span>
    <span id="motion_z">No Z Orientation</span>
</div>

<h2>Your data:</h2>

<table>
    <tr>
        <td>Accessing</td>
        <td id="moApi"></td>
    </tr>
    <tr>
        <td>linear acceleration</td>
        <td id="moAccel"></td>
    </tr>
    <tr>
        <td>acceleration incl. gravity</td>
        <td id="moAccelGrav"></td>
    </tr>
    <tr>
        <td>rotation rate</td>
        <td id="moRotation"></td>
    </tr>
    <tr>
        <td>interval (ms)</td>
        <td id="moInterval"></td>
    </tr>
</table>
<p id="response">Added json post</p>

<script type="application/javascript">

//     fetch("http://10.169.125.87:8080").then((e) => {
//         console.log(e);
//         document.querySelector("#response").innerHTML = JSON.stringify(e);
//     })
//     let data = `{
//   "Id": 78912,
//   "Customer": "Jason Sweet",
//   "Quantity": 1,
//   "Price": 18.00
// }`;

    if ('LinearAccelerationSensor' in window && 'Gyroscope' in window) {
        document.getElementById('moApi').innerHTML = 'Generic Sensor API';

        let lastReadingTimestamp;
        let accelerometer = new LinearAccelerationSensor();
        accelerometer.addEventListener('reading', () => {
            if (lastReadingTimestamp) {
                intervalHandler(Math.round(accelerometer.timestamp - lastReadingTimestamp));
            }
            lastReadingTimestamp = accelerometer.timestamp
            accelerationHandler(accelerometer, 'moAccel');
        });
        accelerometer.start();

        if ('GravitySensor' in window) {
            let gravity = new GravitySensor();
            gravity.addEventListener('reading', () => accelerationHandler(gravity, 'moAccelGrav'));
            gravity.start();
        }

        let gyroscope = new Gyroscope();
        gyroscope.addEventListener('reading', () => rotationHandler({
            alpha: gyroscope.x,
            beta: gyroscope.y,
            gamma: gyroscope.z
        }));
        gyroscope.start();

    } else if ('DeviceMotionEvent' in window) {
        document.getElementById('moApi').innerHTML = 'Device Motion API';

        var onDeviceMotion = function (eventData) {
            accelerationHandler(eventData.acceleration, 'moAccel');
            accelerationHandler(eventData.accelerationIncludingGravity, 'moAccelGrav');
            rotationHandler(eventData.rotationRate);
            intervalHandler(eventData.interval);
        }

        window.addEventListener('devicemotion', onDeviceMotion, false);
    } else {
        document.getElementById('moApi').innerHTML = 'No Accelerometer & Gyroscope API available';
    }

    function accelerationHandler(acceleration, targetId) {
        var info, xyz = "[X, Y, Z]";

        info = xyz.replace("X", acceleration.x && acceleration.x.toFixed(2));
        info = info.replace("Y", acceleration.y && acceleration.y.toFixed(2));
        info = info.replace("Z", acceleration.z && acceleration.z.toFixed(2));
        document.getElementById(targetId).innerHTML = info;

        let xhr = new XMLHttpRequest();
        xhr.open("POST", "http://10.169.125.87:8080");
        xhr.setRequestHeader("Accept", "application/json");
        xhr.setRequestHeader("Content-Type", "application/json");

        let body = {"x": acceleration.x, "y": acceleration.y, "z": acceleration.z};
        xhr.send(JSON.stringify(body));
        document.querySelector("#response").innerHTML = JSON.stringify(body);
    }

    function rotationHandler(rotation) {
        var info, xyz = "[X, Y, Z]";

        info = xyz.replace("X", rotation.alpha && rotation.alpha.toFixed(2));
        info = info.replace("Y", rotation.beta && rotation.beta.toFixed(2));
        info = info.replace("Z", rotation.gamma && rotation.gamma.toFixed(2));
        document.getElementById("moRotation").innerHTML = info;
    }

    function intervalHandler(interval) {
        document.getElementById("moInterval").innerHTML = interval;
    }

    if (window.DeviceOrientationEvent) {
        window.addEventListener("deviceorientation", (event) => {
            const rotateDegrees = event.alpha; // alpha: rotation around z-axis
            const leftToRight = event.gamma; // gamma: left to right
            const frontToBack = event.beta; // beta: front back motion
            document.querySelector("#orientation_x").innerHTML = parseFloat(frontToBack).toFixed(2);
            document.querySelector("#orientation_y").innerHTML = parseFloat(leftToRight).toFixed(2);
            document.querySelector("#orientation_z").innerHTML = parseFloat(rotateDegrees).toFixed(2);
        }, true);
    }

    function handleMotionEvent(event) {
        const x = event.accelerationIncludingGravity.x;
        const y = event.accelerationIncludingGravity.y;
        const z = event.accelerationIncludingGravity.z;

        document.querySelector("#motion_x").innerHTML = parseFloat(x).toFixed(2);
        document.querySelector("#motion_y").innerHTML = parseFloat(y).toFixed(2);
        document.querySelector("#motion_z").innerHTML = parseFloat(z).toFixed(2);
        // Do something awesome.
    }

    window.addEventListener("devicemotion", handleMotionEvent, true);

    function listener(event) {
        document.querySelector("#accelerometer").innerHTML = JSON.stringify(event);
    }

    function listener2(event) {
        document.querySelector("#gyroscope").innerHTML = JSON.stringify(event);
    }

    function listener3(event) {
        document.querySelector("#proxy").innerHTML = JSON.stringify(event);
    }

    sensor = new Accelerometer();
    sensor.addEventListener('reading', listener);
    sensor.start();

    sensor = new Gyroscope()
    sensor.addEventListener('reading', listener2)
    sensor.start()

    sensor = new LinearAccelerationSensor()
    sensor.addEventListener('reading', listener3)
    sensor.start()

</script>
</body>
<html>